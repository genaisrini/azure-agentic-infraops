# Step 7: Operations Runbook - agent-testing

> Generated by azure-workload-docs skill | 2026-02-04
> **Environment**: Development | **Region**: swedencentral

> [!NOTE]
> ðŸ“š See [documentation-styling.md](../../.github/agents/_shared/documentation-styling.md) for visual standards.

## Quick Reference

| Item                 | Value                                        |
| -------------------- | -------------------------------------------- |
| **Resource Group**   | rg-agenttest-dev                             |
| **Subscription**     | noalz (00858ffc-dded-4f0f-8bbf-e17fff0d47d9) |
| **Primary Contact**  | platform-team                                |
| **On-Call Rotation** | N/A (dev environment)                        |
| **Incident Channel** | #platform-team-dev                           |

### Key Endpoints

| Service        | URL                                                                                            | Health Check |
| -------------- | ---------------------------------------------------------------------------------------------- | ------------ |
| App Service    | https://app-agenttest-dev-swc-rqze4t.azurewebsites.net                                         | /health      |
| Container App  | https://ca-agenttest-dev-swc-rqze4t.agreeablewave-f8717171.swedencentral.azurecontainerapps.io | /            |
| Static Web App | https://white-pebble-0f9fca203.4.azurestaticapps.net                                           | /            |
| Key Vault      | https://kv-agenttes-dev-rqze4t.vault.azure.net                                                 | N/A          |
| SQL Server     | sql-agenttest-dev-swc-rqze4t.database.windows.net                                              | Port 1433    |

## 1. Daily Operations

### Morning Checklist

```bash
# 1. Check resource group health
az resource list --resource-group rg-agenttest-dev --query "[].{Name:name, State:provisioningState}" -o table

# 2. Check App Service status
az webapp show --name app-agenttest-dev-swc-rqze4t --resource-group rg-agenttest-dev --query "state" -o tsv

# 3. Check Container App status
az containerapp show --name ca-agenttest-dev-swc-rqze4t --resource-group rg-agenttest-dev --query "properties.runningStatus" -o tsv

# 4. Check SQL Server connectivity
az sql db show --name sqldb-agenttest-dev --server sql-agenttest-dev-swc-rqze4t --resource-group rg-agenttest-dev --query "status" -o tsv

# 5. Review Log Analytics for errors (last 24h)
az monitor log-analytics query \
  --workspace log-agenttest-dev-swc-rqze4t \
  --analytics-query "AppExceptions | where TimeGenerated > ago(24h) | summarize count() by ProblemId" \
  --output table
```

### Health Monitoring

| Metric                  | Warning Threshold | Critical Threshold      | Action           |
| ----------------------- | ----------------- | ----------------------- | ---------------- |
| App Service CPU         | >70%              | >90%                    | Scale up or out  |
| App Service Memory      | >80%              | >95%                    | Restart or scale |
| SQL DTU Usage           | >70%              | >90%                    | Consider upgrade |
| Container App Replicas  | N/A               | 0 (if expected traffic) | Check scaling    |
| Log Analytics Ingestion | >500MB/day        | >1GB/day                | Review logging   |

### Log Queries

**Find errors in App Service:**

```kusto
AppServiceHTTPLogs
| where TimeGenerated > ago(1h)
| where ScStatus >= 500
| project TimeGenerated, CsMethod, CsUriStem, ScStatus, TimeTaken
| order by TimeGenerated desc
```

**Container App logs:**

```kusto
ContainerAppConsoleLogs_CL
| where TimeGenerated > ago(1h)
| where Log_s contains "error" or Log_s contains "exception"
| project TimeGenerated, ContainerAppName_s, Log_s
```

## 2. Incident Response

### Severity Levels

| Level | Description          | Response Time     | Example                  |
| ----- | -------------------- | ----------------- | ------------------------ |
| P1    | Service down         | 15 minutes        | App Service 503 errors   |
| P2    | Degraded performance | 1 hour            | Slow response times      |
| P3    | Minor issue          | 4 hours           | Single component warning |
| P4    | Informational        | Next business day | Log anomalies            |

### Incident Playbooks

#### App Service Down (P1)

```bash
# 1. Check App Service state
az webapp show --name app-agenttest-dev-swc-rqze4t --resource-group rg-agenttest-dev --query "{State:state, Availability:availabilityState}"

# 2. Restart App Service
az webapp restart --name app-agenttest-dev-swc-rqze4t --resource-group rg-agenttest-dev

# 3. Check logs for errors
az webapp log tail --name app-agenttest-dev-swc-rqze4t --resource-group rg-agenttest-dev

# 4. If still failing, check App Insights
az monitor app-insights query \
  --app appi-agenttest-dev-swc-rqze4t \
  --analytics-query "exceptions | take 10"
```

#### Container App Not Responding

```bash
# 1. Check revision status
az containerapp revision list --name ca-agenttest-dev-swc-rqze4t --resource-group rg-agenttest-dev --query "[].{Name:name, Active:properties.active, Replicas:properties.replicas}"

# 2. Check container logs
az containerapp logs show --name ca-agenttest-dev-swc-rqze4t --resource-group rg-agenttest-dev --type console

# 3. Force new revision
az containerapp update --name ca-agenttest-dev-swc-rqze4t --resource-group rg-agenttest-dev --min-replicas 1
```

#### SQL Database Connection Issues

```bash
# 1. Check database status
az sql db show --name sqldb-agenttest-dev --server sql-agenttest-dev-swc-rqze4t --resource-group rg-agenttest-dev --query "{Status:status, MaxSize:maxSizeBytes}"

# 2. Check firewall rules
az sql server firewall-rule list --server sql-agenttest-dev-swc-rqze4t --resource-group rg-agenttest-dev -o table

# 3. Check Azure AD authentication
az sql server ad-admin list --server sql-agenttest-dev-swc-rqze4t --resource-group rg-agenttest-dev
```

## 3. Common Procedures

### Restart Services

```bash
# Restart App Service
az webapp restart --name app-agenttest-dev-swc-rqze4t --resource-group rg-agenttest-dev

# Restart Container App (force new revision)
az containerapp revision restart --name ca-agenttest-dev-swc-rqze4t --resource-group rg-agenttest-dev --revision <revision-name>

# Get latest revision name
az containerapp revision list --name ca-agenttest-dev-swc-rqze4t --resource-group rg-agenttest-dev --query "[0].name" -o tsv
```

### Scale Resources

```bash
# Scale App Service Plan
az appservice plan update --name asp-agenttest-dev-swc-rqze4t --resource-group rg-agenttest-dev --sku S1

# Scale Container App
az containerapp update --name ca-agenttest-dev-swc-rqze4t --resource-group rg-agenttest-dev --min-replicas 1 --max-replicas 5

# Note: SQL Basic tier cannot be scaled without tier change
```

### Access Key Vault Secrets

```bash
# List secrets
az keyvault secret list --vault-name kv-agenttes-dev-rqze4t --query "[].name" -o tsv

# Get secret value
az keyvault secret show --vault-name kv-agenttes-dev-rqze4t --name <secret-name> --query "value" -o tsv

# Note: Requires RBAC permission (Key Vault Secrets User role)
```

### Deploy Application Updates

```bash
# Deploy to App Service (zip deployment)
az webapp deployment source config-zip \
  --name app-agenttest-dev-swc-rqze4t \
  --resource-group rg-agenttest-dev \
  --src app.zip

# Update Container App image
az containerapp update \
  --name ca-agenttest-dev-swc-rqze4t \
  --resource-group rg-agenttest-dev \
  --image <registry>/<image>:<tag>
```

## 4. Maintenance Windows

### Scheduled Maintenance

| Activity              | Frequency | Window              | Impact                |
| --------------------- | --------- | ------------------- | --------------------- |
| Security patches      | Monthly   | 02:00-04:00 UTC Sun | Possible brief outage |
| Bicep updates         | As needed | Business hours      | No impact             |
| Log retention cleanup | Automatic | Daily               | No impact             |
| Backup verification   | Weekly    | 03:00 UTC Sat       | No impact             |

### Pre-Maintenance Checklist

- [ ] Notify stakeholders via #platform-team-dev
- [ ] Verify backup completion
- [ ] Document current resource state
- [ ] Prepare rollback plan
- [ ] Test in isolation if possible

## 5. Contacts & Escalation

### Primary Contacts

| Role               | Contact                   | Availability   |
| ------------------ | ------------------------- | -------------- |
| Platform Team Lead | platform-team@example.com | Business hours |
| DevOps Engineer    | devops@example.com        | Business hours |
| Security Team      | security@example.com      | Business hours |

### Escalation Path

```
L1: Platform Team â†’ L2: DevOps Lead â†’ L3: Cloud Architect â†’ L4: CTO
```

### External Contacts

| Service           | Contact      | SLA            |
| ----------------- | ------------ | -------------- |
| Azure Support     | Azure Portal | Varies by plan |
| Microsoft Premier | TAM          | 1 hour (P1)    |

## 6. Change Log

| Date       | Change                  | Author                     |
| ---------- | ----------------------- | -------------------------- |
| 2026-02-04 | Initial runbook created | deploy agent               |
| 2026-02-04 | Infrastructure deployed | jonathan@lordofthecloud.eu |

---

## References

> [!NOTE]
> ðŸ“š The following Microsoft Learn resources provide operational guidance.

| Topic                 | Link                                                                                             |
| --------------------- | ------------------------------------------------------------------------------------------------ |
| Azure Monitor Alerts  | [Alerting Best Practices](https://learn.microsoft.com/azure/azure-monitor/best-practices-alerts) |
| Log Analytics Queries | [KQL Reference](https://learn.microsoft.com/azure/azure-monitor/logs/get-started-queries)        |
| Service Health        | [Azure Service Health](https://learn.microsoft.com/azure/service-health/overview)                |

---

_Operations runbook generated for agent-testing infrastructure._
