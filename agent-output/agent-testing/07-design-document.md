# Step 7: Design Document - agent-testing

> Generated by azure-workload-docs skill | 2026-02-04
> **Version**: 1.0 | **Status**: As-Built

> [!NOTE]
> ðŸ“š See [documentation-styling.md](../../.github/agents/_shared/documentation-styling.md) for visual standards.

## 1. Introduction

### 1.1 Purpose

This document describes the technical design of the agent-testing infrastructure deployed
to Azure. It serves as the authoritative reference for the architecture, components, and
configurations of this development/testing environment.

### 1.2 Scope

The agent-testing infrastructure provides a comprehensive Azure environment for validating
agentic workflow patterns. It includes compute, data, messaging, monitoring, and security
components suitable for end-to-end testing.

### 1.3 Audience

- Platform Engineers
- DevOps Engineers
- Solution Architects
- Development Teams

### 1.4 Document Conventions

| Term | Definition                 |
| ---- | -------------------------- |
| AVM  | Azure Verified Modules     |
| WAF  | Well-Architected Framework |
| CAF  | Cloud Adoption Framework   |
| IaC  | Infrastructure as Code     |

## 2. Azure Architecture Overview

### 2.1 High-Level Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Azure Subscription (noalz)                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                   Resource Group: rg-agenttest-dev                 â”‚  â”‚
â”‚  â”‚                          (swedencentral)                           â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚  â”‚
â”‚  â”‚  â”‚    Web      â”‚  â”‚   Compute   â”‚  â”‚    Data     â”‚               â”‚  â”‚
â”‚  â”‚  â”‚  Static Web â”‚  â”‚ App Service â”‚  â”‚ SQL Server  â”‚               â”‚  â”‚
â”‚  â”‚  â”‚    App      â”‚  â”‚ Container   â”‚  â”‚ Storage     â”‚               â”‚  â”‚
â”‚  â”‚  â”‚(westeurope) â”‚  â”‚   Apps      â”‚  â”‚ Service Bus â”‚               â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚  â”‚
â”‚  â”‚                                                                    â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚  â”‚
â”‚  â”‚  â”‚  Security   â”‚  â”‚ Monitoring  â”‚                                â”‚  â”‚
â”‚  â”‚  â”‚  Key Vault  â”‚  â”‚ Log Analytics                                â”‚  â”‚
â”‚  â”‚  â”‚             â”‚  â”‚ App Insightsâ”‚                                â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 Design Principles

| Principle              | Implementation                            |
| ---------------------- | ----------------------------------------- |
| Infrastructure as Code | All resources defined in Bicep            |
| Azure Verified Modules | 8 AVM modules for standardization         |
| Least Privilege        | RBAC-based access, managed identities     |
| Cost Optimization      | Dev-tier SKUs, scale-to-zero              |
| Observability          | Centralized logging, Application Insights |

### 2.3 Deployment Model

- **IaC Tool**: Bicep with Azure Verified Modules
- **Deployment Method**: Azure CLI / PowerShell
- **Source Control**: Git (GitHub)
- **CI/CD**: Manual deployment (dev environment)

## 3. Networking

### 3.1 Network Topology

This development environment uses public endpoints for simplicity:

| Resource       | Network Access    | Justification           |
| -------------- | ----------------- | ----------------------- |
| App Service    | Public            | Dev/test accessibility  |
| Container App  | Public (ingress)  | Dev/test accessibility  |
| SQL Server     | Public + Firewall | Azure services allowed  |
| Key Vault      | Public            | RBAC protected          |
| Storage        | Public            | RBAC protected          |
| Static Web App | Public            | Static content delivery |

### 3.2 Security Controls

| Control        | Implementation                        |
| -------------- | ------------------------------------- |
| TLS            | 1.2 minimum for all services          |
| HTTPS          | Enforced for web services             |
| Firewall       | SQL Server allows Azure services only |
| Authentication | Azure AD for SQL, RBAC for Key Vault  |

### 3.3 Future Considerations

For production, consider:

- Virtual Network integration
- Private Endpoints for data services
- Application Gateway with WAF
- Network Security Groups

## 4. Storage

### 4.1 Storage Account

| Property    | Value                |
| ----------- | -------------------- |
| Name        | stagenttestdevrqze4t |
| SKU         | Standard_LRS         |
| Kind        | StorageV2            |
| Access Tier | Hot                  |
| Redundancy  | Locally redundant    |

### 4.2 Security Configuration

| Setting            | Value         |
| ------------------ | ------------- |
| HTTPS Only         | Enabled       |
| Minimum TLS        | 1.2           |
| Public Blob Access | Disabled      |
| Shared Key Access  | Enabled (dev) |
| Soft Delete        | 7 days        |

### 4.3 Blob Services

- Container delete retention: 7 days
- Blob delete retention: 7 days
- Versioning: Not enabled (dev)

## 5. Compute

### 5.1 App Service

| Property | Value                        |
| -------- | ---------------------------- |
| Plan     | asp-agenttest-dev-swc-rqze4t |
| SKU      | B1 (Basic)                   |
| OS       | Linux                        |
| Runtime  | .NET 8.0                     |

**Configuration:**

- Always On: Disabled (B1 limitation)
- HTTP/2: Enabled
- FTPS: Disabled
- HTTPS Only: Enabled

### 5.2 Container Apps

| Property    | Value                                                       |
| ----------- | ----------------------------------------------------------- |
| Environment | cae-agenttest-dev-swc-rqze4t                                |
| App         | ca-agenttest-dev-swc-rqze4t                                 |
| Image       | mcr.microsoft.com/azuredocs/containerapps-helloworld:latest |

**Scaling:**

- Min Replicas: 0 (scale to zero)
- Max Replicas: 3
- CPU: 0.25 vCPU
- Memory: 0.5 GB

### 5.3 Static Web App

| Property             | Value                          |
| -------------------- | ------------------------------ |
| Name                 | stapp-agenttest-dev-weu-rqze4t |
| SKU                  | Standard                       |
| Location             | westeurope (region limitation) |
| Staging Environments | Enabled                        |

## 6. Identity & Access

### 6.1 Managed Identities

All applicable resources use system-assigned managed identities:

| Resource        | Identity Type   | Purpose          |
| --------------- | --------------- | ---------------- |
| App Service     | System-assigned | Key Vault access |
| Container App   | System-assigned | Key Vault access |
| SQL Server      | System-assigned | Azure AD auth    |
| Storage Account | System-assigned | RBAC integration |

### 6.2 RBAC Assignments

| Role                     | Scope      | Principal            |
| ------------------------ | ---------- | -------------------- |
| Key Vault Secrets User   | Key Vault  | App Service MI       |
| Storage Blob Data Reader | Storage    | App Service MI       |
| SQL Server Contributor   | SQL Server | Deployment principal |

### 6.3 SQL Authentication

- **Mode**: Azure AD-only authentication
- **Admin**: SQL Administrators group
- **Login**: Azure AD integrated

## 7. Security & Compliance

### 7.1 Encryption

| Data State | Encryption                   |
| ---------- | ---------------------------- |
| At Rest    | Azure-managed keys (default) |
| In Transit | TLS 1.2+                     |
| Key Vault  | Software-protected keys      |

### 7.2 Network Security

| Service    | Protection                        |
| ---------- | --------------------------------- |
| SQL Server | Azure Services firewall rule      |
| Key Vault  | RBAC authorization                |
| Storage    | HTTPS only, no public blob access |

### 7.3 Compliance Status

| Framework | Status    | Notes                             |
| --------- | --------- | --------------------------------- |
| Azure WAF | Aligned   | Dev environment, relaxed controls |
| GDPR      | Compliant | Data in EU (Sweden Central)       |
| PCI DSS   | N/A       | No payment data                   |

## 8. Backup & Disaster Recovery

### 8.1 Backup Configuration

| Resource     | Backup Type   | Retention |
| ------------ | ------------- | --------- |
| SQL Database | Point-in-time | 7 days    |
| Storage      | Soft delete   | 7 days    |
| Key Vault    | Soft delete   | 90 days   |

### 8.2 Recovery Objectives

| Metric | Target   |
| ------ | -------- |
| RTO    | 4 hours  |
| RPO    | 24 hours |

### 8.3 DR Strategy

- Infrastructure rebuild from Bicep templates
- Data restore from Azure-managed backups
- No cross-region replication (dev environment)

## 9. Management & Monitoring

### 9.1 Log Analytics Workspace

| Property    | Value                        |
| ----------- | ---------------------------- |
| Name        | log-agenttest-dev-swc-rqze4t |
| SKU         | PerGB2018                    |
| Retention   | 30 days                      |
| Daily Quota | 1 GB                         |

### 9.2 Application Insights

| Property  | Value                         |
| --------- | ----------------------------- |
| Name      | appi-agenttest-dev-swc-rqze4t |
| Type      | Web application               |
| Retention | 30 days                       |
| Sampling  | Default                       |

### 9.3 Diagnostic Settings

All resources send diagnostics to Log Analytics:

| Resource    | Logs                    | Metrics     |
| ----------- | ----------------------- | ----------- |
| Key Vault   | AuditEvent              | AllMetrics  |
| App Service | HTTP, Console, App logs | AllMetrics  |
| Storage     | -                       | Transaction |
| Service Bus | OperationalLogs         | AllMetrics  |

### 9.4 Alerts (Recommended)

| Alert                  | Condition          | Severity |
| ---------------------- | ------------------ | -------- |
| App Service Errors     | HTTP 5xx > 10/5min | Warning  |
| SQL DTU Usage          | > 80%              | Warning  |
| Container App Failures | Restart count > 3  | Error    |

## 10. Appendix

### 10.1 Resource Naming Convention

Pattern: `{type}-{project}-{env}-{region}-{suffix}`

| Component   | Value                 |
| ----------- | --------------------- |
| Project     | agenttest             |
| Environment | dev                   |
| Region      | swc (swedencentral)   |
| Suffix      | rqze4t (uniqueString) |

### 10.2 Tags

| Tag         | Value         |
| ----------- | ------------- |
| Environment | dev           |
| ManagedBy   | Bicep         |
| Project     | agenttest     |
| Owner       | platform-team |
| CostCenter  | CC-AGENTOPS   |

### 10.3 Bicep Module Versions

| Module                         | Version |
| ------------------------------ | ------- |
| operational-insights/workspace | 0.15.0  |
| insights/component             | 0.7.1   |
| key-vault/vault                | 0.13.3  |
| storage/storage-account        | 0.31.0  |
| web/serverfarm                 | 0.6.0   |
| web/site                       | 0.21.0  |
| app/managed-environment        | 0.11.3  |
| app/container-app              | 0.20.0  |
| sql/server                     | 0.21.1  |
| service-bus/namespace          | 0.16.1  |
| web/static-site                | 0.9.3   |

### 10.4 Related Documents

- [06-deployment-summary.md](06-deployment-summary.md) - Deployment details
- [07-resource-inventory.md](07-resource-inventory.md) - Complete resource list
- [07-operations-runbook.md](07-operations-runbook.md) - Operational procedures
- [07-backup-dr-plan.md](07-backup-dr-plan.md) - Recovery procedures

---

## References

> [!NOTE]
> ðŸ“š The following Microsoft Learn resources provide additional guidance.

| Topic                      | Link                                                                               |
| -------------------------- | ---------------------------------------------------------------------------------- |
| Well-Architected Framework | [Overview](https://learn.microsoft.com/azure/well-architected/)                    |
| Azure Architecture Center  | [Architectures](https://learn.microsoft.com/azure/architecture/)                   |
| Security Best Practices    | [Security Baseline](https://learn.microsoft.com/security/benchmark/azure/overview) |
| Azure Monitor              | [Overview](https://learn.microsoft.com/azure/azure-monitor/overview)               |

---

_Design document generated for agent-testing infrastructure._
