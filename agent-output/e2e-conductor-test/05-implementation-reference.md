# Step 5: Implementation Reference - e2e-conductor-test

> Generated by bicep-code agent | 2025-05-27

> [!NOTE]
> ðŸ“š See [documentation-styling.md](../agents/_shared/documentation-styling.md) for visual standards.

## Bicep Templates Location

ðŸ“ **Code Location**: [`infra/bicep/e2e-conductor-test/`](../../infra/bicep/e2e-conductor-test/)

## File Structure

```
infra/bicep/e2e-conductor-test/
â”œâ”€â”€ main.bicep              # Main orchestration template (subscription scope)
â”œâ”€â”€ main.bicepparam         # Parameter file
â”œâ”€â”€ deploy.ps1              # PowerShell deployment script
â””â”€â”€ modules/
    â”œâ”€â”€ resource-group.bicep    # Resource group deployment
    â”œâ”€â”€ static-web-app.bicep    # Static Web App deployment
    â”œâ”€â”€ cdn.bicep               # CDN Profile and Endpoint
    â””â”€â”€ monitoring.bicep        # Log Analytics + Action Group + Metric Alert
```

## Validation Status

| Check         | Status                  |
| ------------- | ----------------------- |
| `bicep build` | âœ… **PASSED**           |
| `bicep lint`  | âœ… **PASSED (no warnings)** |
| `bicep format`| âœ… **APPLIED**          |

## Resources Created

| Resource             | Bicep Type                                   | Module                  | AVM Version |
| -------------------- | -------------------------------------------- | ----------------------- | ----------- |
| Resource Group       | Microsoft.Resources/resourceGroups           | resource-group.bicep    | 0.4.3       |
| Static Web App       | Microsoft.Web/staticSites                    | static-web-app.bicep    | 0.9.3       |
| CDN Profile          | Microsoft.Cdn/profiles                       | cdn.bicep               | 0.17.1      |
| Log Analytics        | Microsoft.OperationalInsights/workspaces     | monitoring.bicep        | 0.15.0      |
| Action Group         | Microsoft.Insights/actionGroups              | monitoring.bicep        | 0.6.2       |
| Metric Alert         | Microsoft.Insights/metricAlerts              | monitoring.bicep        | 0.4.1       |

## Deployment Instructions

### Quick Deploy

```powershell
cd infra/bicep/e2e-conductor-test
./deploy.ps1
```

### Preview Changes (What-If)

```powershell
./deploy.ps1 -WhatIf
```

### Custom Parameters

```powershell
./deploy.ps1 `
    -Location "swedencentral" `
    -Environment "dev" `
    -TechnicalContact "user@example.com"
```

## Key Implementation Notes

### Subscription Scope Deployment

This template deploys at **subscription scope** to create the resource group first:

```bicep
targetScope = 'subscription'

// Deploy resource group
module resourceGroup 'modules/resource-group.bicep' = {
  name: 'deploy-rg-${projectName}'
  params: { ... }
}

// Deploy resources into the resource group
module staticWebApp 'modules/static-web-app.bicep' = {
  scope: az.resourceGroup(subscription().subscriptionId, resourceGroupName)
  dependsOn: [resourceGroup]
  params: { ... }
}
```

### CDN Integration

CDN endpoint configured with:
- Origin: Static Web App hostname (auto-detected)
- SKU: `Standard_Microsoft`
- Compression: Enabled for HTML, CSS, JS, JSON, SVG
- Cache: Query string ignored
- Security: HTTPS only, HTTP disabled

### Monitoring Stack

**Log Analytics Workspace:**
- Retention: 30 days
- Quota: Unlimited (`-1`)
- Public access: Enabled (for testing)

**Action Group:**
- Email notification to technical contact

**Metric Alert:**
- Trigger: CDN 4XX errors > 50% (15-minute window)
- Severity: Warning (2)
- Auto-mitigation: Enabled

### Azure Verified Modules (AVM)

All resources use **100% AVM modules** from the public registry (`br/public:avm/`):
- âœ… No raw Bicep resources
- âœ… Latest stable versions
- âœ… Built-in security defaults
- âœ… Consistent tagging and diagnostic settings

### Region Compliance

- **Primary Region**: `swedencentral` (default)
- **Alternative**: `germanywestcentral`
- Static Web App SKU: `Free` (region-agnostic)

### Required Tags

All resources tagged with:
- `Environment`: dev/staging/prod
- `ManagedBy`: Bicep
- `Project`: e2e-conductor-test
- `Owner`: Technical contact
- `maint-window`: weekends
- `technical-contact`: Email

### Pre-flight Check Results

âœ… **AVM Schema Validation**: [See 04-preflight-check.md](./04-preflight-check.md)

- All 6 resources mapped to AVM modules
- Parameter types validated
- Region compatibility confirmed
- No known pitfalls identified

## Next Steps

1. **Review**: Verify templates meet requirements
2. **Deploy**: Run `deploy.ps1` to deploy to Azure
3. **Test**: Validate deployed resources
4. **Document**: Generate as-built documentation (Step 7)

### Known Issues

**None** - All build and lint checks passed.

---

_Implementation reference generated from Bicep templates after successful validation._
